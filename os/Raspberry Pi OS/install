#!/bin/bash

# install - run as part of fleetsiemod when modifying a Raspberry Pi OS image
#
# This script must be run from the directory it lives in.
# It assumes the target image partitions are mounted in the directory
# given by environment variable TARGET_ROOT.  The partitions there must
# be avilable via symlinks "bootfs" and "rootfs"

BOOTFS=$TARGET_ROOT/bootfs
ROOTFS=$TARGET_ROOT/rootfs
SYSTEMD=$ROOTFS/etc/systemd/system
OPT=$ROOTFS/opt/fleetsie

DST=$SYSTEMD/fleetsie-provision.service
cp ./fleetsie-provision.service $DST
chown root:root $DST
ln -sf /etc/systemd/system/fleetsie-provision.service $SYSTEMD/multi-user.target.wants

mkdir -p $OPT
chown root:root $OPT
DST=$OPT/fleetsie_provision
cp ./fleetsie_provision $DST
chown root:root $DST
chmod oug+x $DST
